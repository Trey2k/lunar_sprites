#!/usr/bin/env python

import os

from api_builder import make_api_header

Import("env")
Import("env_modules")

env_native_api = env.Clone()

api_header_txt = make_api_header()
native_application_gen_c = """
/* THIS FILE IS GENERATED DO NOT EDIT */
#include "native_application.h"

const unsigned char *LS_API_HEADER = (const unsigned char[%d]){
""" % (len(api_header_txt) + 1)

bytes_per_line = 16
native_application_gen_c += "\t"
for i, c in enumerate(api_header_txt):
    native_application_gen_c += str(ord(c)) + ', '
    if i % bytes_per_line == 0 and i != 0:
        native_application_gen_c += '\n\t'

native_application_gen_c += "0"

native_application_gen_c += """
};
"""

with open('native_application.gen.c', 'w') as f:
    f.write(native_application_gen_c)

env_native_api.add_source_files(env.modules_sources, "*.c")
env_native_api.add_source_files(env.modules_sources, "native_application.gen.c")

Export("env_native_api")

if env["api_test_client"]:
    SConscript("test_application/SCsub")
